<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/quarto-contrib/qrcodejs-v1.0.0/qrcode.js"></script><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Neal Richardson">
  <meta name="dcterms.date" content="2025-08-10">
  <title>Scaling Up Data Workflows</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto-79de7379233449a958139d6a18b1afaf.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <style>
  .container {
      height: 100%;
      width: 100%;
      display: table;
      table-layout: fixed;
      text-align: center;
  }

  .inside {
      vertical-align: middle;
      display: table-cell;
  }

  .really-big {
      font-size: 256px;
  }

  .extrapad {
      margin-top:1em  !important;
  }
  .v-spacier {
      margin-bottom: 2em;
      margin-top: 2em;
  }

  div.my-footer {
      position: absolute;
      bottom: 0px;
      left: 0px;
      height: 20px;
      width: 100%;
  }
  div.my-footer span {
      font-size: 16pt;
      font-family: "Roboto", sans-serif;
      position: absolute;
      color: #777;
      left: 16px;
      bottom: 16px;
  }

  .qrcode {
      display: flex;
      justify-content: center;
  }
  </style>
  </head><body class="quarto-light"><div class="my-footer"><span>https://enpiar.com/user-2025/</span></div>


  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Scaling Up Data Workflows</h1>
  <p class="subtitle">with Arrow, Parquet, and DuckDB</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Neal Richardson 
</div>
        <p class="quarto-title-affiliation">
            useR! Conference 2025
          </p>
    </div>
</div>

  <p class="date">August 10, 2025</p>
</section>
<section id="section" class="slide level2 center really-big">
<h2>😂</h2>
<!-- R is fun! -->
<!-- Until your data gets really big -->
</section>
<section id="section-1" class="slide level2 center really-big">
<h2>😭</h2>
<!-- R is designed to work with data that fits in memory -->
</section>
<section id="section-2" class="slide level2 center really-big">
<h2>🧠</h2>
<!-- When it doesn't, it's not pretty. And we have to reach for other tools -->
</section>
<section id="section-3" class="slide level2 center really-big">
<h2>🤯</h2>
</section>
<section id="section-4" class="slide level2 center">
<h2><img src="img/arrow-logo.png"></h2>
<!-- Today I'm going to talk about how the Arrow project and broader ecosystem of tools can help us work with large datasets in R.
-->
</section>
<section id="section-5" class="slide level2 center">
<h2><img src="img/arrow-hex.png" height="500px"></h2>
<!-- I'm one of the creators of the `arrow` R package, and most of the examples I'll show are from it.

how many of you are familiar with the arrow package? have used it? were at the workshop on Friday?
-->
</section>
<section id="section-6" class="slide level2">
<h2><img src="img/arrow-site.png"></h2>
<!-- But the Arrow project is much larger than one package. At its core, Arrow is a standard for how to represent data efficiently. And there is a whole ecosystem of tools and libraries that work together to make data processing easier and more efficient. This common standard allows them to interoperate easily. So I'll also talk about some of the other packages that are part of this ecosystem.
 -->
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<p>US Census Public Use Microdata Sample (PUMS)</p>
<ul>
<li><p>53 million rows</p></li>
<li><p>311 columns</p></li>
<li><p>45 GB in CSVs on disk</p></li>
<li><p>~80 GB in memory in R (if it were possible)</p></li>
</ul>
</section>
<section id="example-1" class="slide level2">
<h2>Example</h2>
<p>With <code>arrow</code>, it is possible</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">library</span>(arrow)</span>
<span id="cb1-2"><a href=""></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href=""></a><span class="fu">library</span>(tictoc)</span>
<span id="cb1-4"><a href=""></a></span>
<span id="cb1-5"><a href=""></a>pums_person <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(<span class="st">"./data/person"</span>)</span>
<span id="cb1-6"><a href=""></a></span>
<span id="cb1-7"><a href=""></a><span class="fu">tic</span>()</span>
<span id="cb1-8"><a href=""></a>pums_person <span class="sc">|&gt;</span></span>
<span id="cb1-9"><a href=""></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2021</span>, <span class="fu">grepl</span>(<span class="st">"Subway|Light rail"</span>, JWTRNS)) <span class="sc">|&gt;</span></span>
<span id="cb1-10"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">sum</span>(PWGTP)) <span class="sc">|&gt;</span></span>
<span id="cb1-11"><a href=""></a>  <span class="fu">collect</span>()</span>
<span id="cb1-12"><a href=""></a></span>
<span id="cb1-13"><a href=""></a><span class="do">## # A tibble: 1 × 1</span></span>
<span id="cb1-14"><a href=""></a><span class="do">##         n</span></span>
<span id="cb1-15"><a href=""></a><span class="do">##     &lt;int&gt;</span></span>
<span id="cb1-16"><a href=""></a><span class="do">## 1 1495898</span></span>
<span id="cb1-17"><a href=""></a><span class="fu">toc</span>()</span>
<span id="cb1-18"><a href=""></a></span>
<span id="cb1-19"><a href=""></a><span class="do">## 0.157 sec elapsed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="how-does-this-work" class="slide level2">
<h2>How does this work?</h2>
<ol type="1">
<li><p>Parquet files for storing data on disk</p></li>
<li><p>Dataset: data chunked into meaningful partitions (files)</p></li>
<li><p>Arrow’s fast query engine, computing in parallel across chunks of data</p></li>
</ol>
</section>
<section id="theres-a-book" class="slide level2">
<h2>There’s a book!</h2>
<!-- If you want to go deeper on any of these topics, we have a book!

And links throughout the slides to the chapters in the book where we discuss more
-->
<div class="columns">
<div class="column fragment" style="text-align: center;">
<p><img src="img/book.jpg" alt="book cover" height="300px"></p>
<!-- Note: I modified qrcode.lua so that it wraps the QR code in an <a> tag -->
<a href="www.routledge.com/9781032660288" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"www.routledge.com/9781032660288","width":128});
  script.remove();
})();
</script>
    
<p>20% off with code <code>25AFLY3</code></p>
</div><div class="column fragment" style="text-align: center;">
<p><img src="img/book-site.jpg" alt="book site" height="300px"></p>
<a href="https://arrowrbook.com" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrowrbook.com","width":128});
  script.remove();
})();
</script>
    
<p><a href="https://arrowrbook.com">arrowrbook.com</a></p>
</div></div>
</section>
<section id="parquet-files" class="slide level2">
<h2>1. Parquet files</h2>
<!-- parquet logo, link to website -->
<!-- Like Arrow, Parquet is a project affiliated with the ASF and defines an open source specification for data files, and also like Arrow, it has become the standard for how to store data in the modern data stack.

Wide adoption both because of its efficiency and because it is a common format that many tools can read and write.

Let's talk about why it is efficient, and to start, let's talk about how it is different from CSV files.
 -->
<ul>
<li><p>Open standard file format for storing data on disk</p></li>
<li><p>Arrow : Memory :: Parquet : Disk</p></li>
<li><p>Widely adopted across big data ecosystem, implemented in many languages</p></li>
</ul>
<a href="https://arrowrbook.com/files_and_formats.html" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrowrbook.com/files_and_formats.html","width":128});
  script.remove();
})();
</script>
    
</section>
<section id="csv-vs.-parquet" class="slide level2">
<h2>CSV vs.&nbsp;Parquet</h2>
<div>
<ul>
<li class="fragment"><p>Row vs.&nbsp;column orientation: Parquet is <strong>columnar</strong> (like R and Arrow)</p></li>
<li class="fragment"><p>Columnar allows selected reading of data: we usually don’t need all columns</p></li>
<li class="fragment"><p>Columnar allows better compression and encoding</p></li>
<li class="fragment"><p>Types: <strong>rich type system</strong> in Parquet, including nested and complex types</p></li>
<li class="fragment"><p>Types are preserved in schema, not inferred at read time</p></li>
<li class="fragment"><p><strong>High fidelity, smaller file sizes, faster reads</strong></p></li>
</ul>
</div>
<a href="https://arrowrbook.com/files_and_formats.html#summary" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrowrbook.com/files_and_formats.html#summary","width":128});
  script.remove();
})();
</script>
    
</section>
<section id="reading-and-writing-parquet-files" class="slide level2">
<h2>Reading and writing Parquet files</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a><span class="fu">library</span>(arrow)</span>
<span id="cb2-2"><a href=""></a></span>
<span id="cb2-3"><a href=""></a><span class="co"># Write a Parquet file</span></span>
<span id="cb2-4"><a href=""></a><span class="fu">write_parquet</span>(mtcars, <span class="st">"mtcars.parquet"</span>)</span>
<span id="cb2-5"><a href=""></a></span>
<span id="cb2-6"><a href=""></a><span class="co"># Read a Parquet file</span></span>
<span id="cb2-7"><a href=""></a>mtcars_parquet <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="st">"mtcars.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="reading-and-writing-parquet-files-1" class="slide level2">
<h2>Reading and writing Parquet files</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a><span class="fu">library</span>(nanoparquet)</span>
<span id="cb3-2"><a href=""></a></span>
<span id="cb3-3"><a href=""></a><span class="co"># Write a Parquet file</span></span>
<span id="cb3-4"><a href=""></a><span class="fu">write_parquet</span>(mtcars, <span class="st">"mtcars.parquet"</span>)</span>
<span id="cb3-5"><a href=""></a></span>
<span id="cb3-6"><a href=""></a><span class="co"># Read a Parquet file</span></span>
<span id="cb3-7"><a href=""></a>mtcars_parquet <span class="ot">&lt;-</span> <span class="fu">read_parquet</span>(<span class="st">"mtcars.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="nanoparquet-vs.-arrow-reader" class="slide level2">
<h2>nanoparquet vs.&nbsp;arrow Reader</h2>
<ul>
<li><strong>nanoparquet</strong>
<ul>
<li>Lightweight Parquet reader</li>
<li>Minimal dependencies</li>
<li>Good for embedding</li>
</ul></li>
<li><strong>arrow</strong>
<ul>
<li>Full-featured reader</li>
<li>Support for datasets</li>
<li>Integration with Arrow ecosystem</li>
</ul></li>
</ul>
</section>
<section id="datasets-and-partitioning" class="slide level2">
<h2>2. Datasets and partitioning</h2>
<!-- but in the query I showed above, we didn't read individual files, we 800+ files as one entity -->
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a>pums_person</span>
<span id="cb4-2"><a href=""></a></span>
<span id="cb4-3"><a href=""></a><span class="do">## FileSystemDataset with 884 Parquet files</span></span>
<span id="cb4-4"><a href=""></a><span class="do">## 311 columns</span></span>
<span id="cb4-5"><a href=""></a><span class="do">## SPORDER: int32</span></span>
<span id="cb4-6"><a href=""></a><span class="do">## RT: dictionary&lt;values=string, indices=int32&gt;</span></span>
<span id="cb4-7"><a href=""></a><span class="do">## SERIALNO: string</span></span>
<span id="cb4-8"><a href=""></a><span class="do">## PUMA: string</span></span>
<span id="cb4-9"><a href=""></a><span class="do">## ST: string</span></span>
<span id="cb4-10"><a href=""></a><span class="do">## ADJUST: int32</span></span>
<span id="cb4-11"><a href=""></a><span class="do">## PWGTP: int32</span></span>
<span id="cb4-12"><a href=""></a>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="datasets-and-partitioning-1" class="slide level2">
<h2>2. Datasets and partitioning</h2>
<!-- In fact, that's how our PUMS dataset is stored: -->
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a>pums_person<span class="sc">$</span>files[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="sc">|&gt;</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(<span class="st">"^.*data/person/"</span>, <span class="st">""</span>)</span>
<span id="cb5-2"><a href=""></a></span>
<span id="cb5-3"><a href=""></a><span class="do">##  [1] "year=2005/location=ak/part-0.parquet"</span></span>
<span id="cb5-4"><a href=""></a><span class="do">##  [2] "year=2005/location=al/part-0.parquet"</span></span>
<span id="cb5-5"><a href=""></a><span class="do">##  [3] "year=2005/location=ar/part-0.parquet"</span></span>
<span id="cb5-6"><a href=""></a><span class="do">##  [4] "year=2005/location=az/part-0.parquet"</span></span>
<span id="cb5-7"><a href=""></a><span class="do">##  [5] "year=2005/location=ca/part-0.parquet"</span></span>
<span id="cb5-8"><a href=""></a><span class="do">##  [6] "year=2005/location=co/part-0.parquet"</span></span>
<span id="cb5-9"><a href=""></a><span class="do">##  [7] "year=2005/location=ct/part-0.parquet"</span></span>
<span id="cb5-10"><a href=""></a><span class="do">##  [8] "year=2005/location=dc/part-0.parquet"</span></span>
<span id="cb5-11"><a href=""></a><span class="do">##  [9] "year=2005/location=de/part-0.parquet"</span></span>
<span id="cb5-12"><a href=""></a><span class="do">## [10] "year=2005/location=fl/part-0.parquet"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>“Hive-style partitioning”: both column names and values are encoded in the file path</p>
</section>
<section id="datasets-and-partitioning-2" class="slide level2">
<h2>2. Datasets and partitioning</h2>
<ul>
<li><p>Convention: directory (or bucket in cloud storage) of Parquet files with a common schema</p></li>
<li><p>We can split data into files called partitions based on the values of one or more columns</p></li>
<li><p>When we query it, can skip over files that don’t match our query</p></li>
</ul>
<!-- , which is one trick that helps make many queries fast -->
<a href="https://arrowrbook.com/datasets.html" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrowrbook.com/datasets.html","width":128});
  script.remove();
})();
</script>
    
</section>
<section id="datasets-and-partitioning-3" class="slide level2">
<h2>2. Datasets and partitioning</h2>
<p>Example query from before:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a>pums_person <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href=""></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2021</span>, <span class="fu">grepl</span>(<span class="st">"Subway|Light rail"</span>, JWTRNS)) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">sum</span>(PWGTP)) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href=""></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We didn’t have to scan 884 files, we only had to scan the 52 files that contain data for the year 2021: <!-- but don't talk about column selection here, save that for query engine --></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a>pums_person<span class="sc">$</span>files <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href=""></a>  stringr<span class="sc">::</span><span class="fu">str_detect</span>(<span class="st">"year=2021"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href=""></a>  <span class="fu">sum</span>()</span>
<span id="cb7-4"><a href=""></a></span>
<span id="cb7-5"><a href=""></a><span class="do">## [1] 52</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="how-to-repartition-with-arrow" class="slide level2">
<h2>How to (re)partition with arrow</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a>my_dataset <span class="ot">&lt;-</span> <span class="fu">open_csv_dataset</span>(<span class="at">path =</span> <span class="st">"./data/my-oversized-csv.csv"</span>)</span>
<span id="cb8-2"><a href=""></a></span>
<span id="cb8-3"><a href=""></a>my_dataset <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(datetime), <span class="at">month =</span> <span class="fu">month</span>(datetime)) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href=""></a>  <span class="fu">write_dataset</span>(</span>
<span id="cb8-6"><a href=""></a>    <span class="at">path =</span> <span class="st">"./data/my-much-nicer-parquet-dataset"</span>,</span>
<span id="cb8-7"><a href=""></a>    <span class="at">partitioning =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"month"</span>)</span>
<span id="cb8-8"><a href=""></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Can point at a single large file that you can’t read into memory: <code>arrow</code> can process in chunks</p></li>
<li><p>Can use a dataset that already has partitions and write to new partitions</p></li>
</ul>
</section>
<section id="optimal-partitioning" class="slide level2">
<h2>Optimal partitioning</h2>
<div class="fragment">
<h3 id="it-depends"><strong>It depends!</strong></h3>
</div>
<div>
<ul>
<li class="fragment"><p>What queries you will run</p></li>
<li class="fragment"><p>Number of unique values in partition columns</p></li>
<li class="fragment"><p>Too many partitions –&gt; too many files, lose the benefits of column orientation and compression</p></li>
</ul>
</div>
<a href="https://arrowrbook.com/datasets.html#how-partitioning-affects-performance" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrowrbook.com/datasets.html#how-partitioning-affects-performance","width":128});
  script.remove();
})();
</script>
    
</section>
<section id="query-engines" class="slide level2">
<h2>3. Query engines</h2>
<!-- query engine is database - storage. draw diagrams: database is box containing query engine + storage. then we split them. then we say storage is directory of partitioned files. then engines are arrow or duckdb.

-->
</section>
<section id="section-7" class="slide level2" style="text-align: center;">
<h2></h2>

<img src="img/database.png" class="r-stretch"></section>
<section id="section-8" class="slide level2" style="text-align: center;">
<h2></h2>

<img src="img/qe-and-storage.png" class="r-stretch"></section>
<section id="section-9" class="slide level2" style="text-align: center;">
<h2></h2>

<img src="img/separated.png" class="r-stretch"></section>
<section id="section-10" class="slide level2" style="text-align: center;">
<h2></h2>

<img src="img/qe-with-files.png" class="r-stretch"></section>
<section id="section-11" class="slide level2" style="text-align: center;">
<h2></h2>

<!--

one great feature of this architecture is that you don't need some service always running to query the data. arrow and duckdb are just packages you load into your R process, and the data is just there on disk. so it's way simpler -->
<!-- One great thing about this stack is that query engines and storage are decoupled. Arrow and DuckDB can both read and write Parquet files, so you can use either one as your query engine, or even use both in the same workflow if you want to. And the engine itself is just a library that you can install from CRAN, and it runs in your R process, so you don't have any extra infrastructure to manage. -->
<img src="img/packages.png" class="r-stretch"></section>
<section id="query-planning-and-lazy-evaluation" class="slide level2">
<h2>Query planning and lazy evaluation</h2>
<!-- query engine is different from operating on a data frame in memory. we basically have to plan out what we want it to do, not just do one step and then the next. that way, it can make optimizations.

To do this with dplyr, arrow works similarly to `dbplyr` and builds up a query with each step in your pipeline, and it only evaluates it when you call `collect()`. [show example query output; also show how this means it can determine that not only do we only need those 52 files, we only touch 2 other columns in the data, so we don't even need to read in the other 309.]
-->
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a>pums_person <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href=""></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2021</span>, <span class="fu">grepl</span>(<span class="st">"Subway|Light rail"</span>, JWTRNS)) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href=""></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">sum</span>(PWGTP)) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href=""></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>Each step builds up a query, like <code>dbplyr</code></p></li>
<li><p>No computation happens until <code>collect()</code></p></li>
<li><p>This allows optimizations: only need 52 files and 2 columns, not 884 files and 311 columns</p></li>
</ul>
</section>
<section id="arrow-has-great-dplyr-support" class="slide level2">
<h2><code>arrow</code> has great <code>dplyr</code> support</h2>
<ul>
<li><p>Currently: 222 R functions, 37 <code>dplyr</code> verbs</p></li>
<li><p>All the things you’d expect from <code>dbplyr</code></p></li>
<li><p>Deep support for <code>stringr</code> and <code>lubridate</code></p></li>
</ul>
</section>
<section id="arrow-has-great-dplyr-support-1" class="slide level2">
<h2><code>arrow</code> has great <code>dplyr</code> support</h2>
<!--
`arrow` has great dplyr support, including mappings for over 200 R functions, much of `stringr` and `lubridate`, so you can use your existing R code with it, and it will get turned into the query structure that it needs.

then what about duckdb
-->
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a>pums_person <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href=""></a>  <span class="fu">filter</span>(AGEP <span class="sc">&gt;</span> <span class="dv">18</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href=""></a>  <span class="fu">transmute</span>(</span>
<span id="cb10-4"><a href=""></a>    <span class="at">higher_education =</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(SCHL, <span class="st">"(Bach|Mast|Prof|Doct|college|degree)"</span>)</span>
<span id="cb10-5"><a href=""></a>  )</span>
<span id="cb10-6"><a href=""></a></span>
<span id="cb10-7"><a href=""></a><span class="do">## FileSystemDataset (query)</span></span>
<span id="cb10-8"><a href=""></a><span class="do">## higher_education: bool (match_substring_regex(SCHL, {pattern="(Bach|Mast|Prof|Doct|college|degree)", ignore_case=false}))</span></span>
<span id="cb10-9"><a href=""></a><span class="do">##</span></span>
<span id="cb10-10"><a href=""></a><span class="do">## * Filter: (AGEP &gt; 18)</span></span>
<span id="cb10-11"><a href=""></a><span class="do">## See $.data for the source Arrow object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="arrow-has-great-dplyr-support-2" class="slide level2">
<h2><code>arrow</code> has great <code>dplyr</code> support</h2>
<ul>
<li><p>Currently: 222 R functions, 37 <code>dplyr</code> verbs</p></li>
<li><p>All the things you’d expect from <code>dbplyr</code></p></li>
<li><p>Deep support for <code>stringr</code> and <code>lubridate</code></p></li>
<li><p>Additional <code>arrow</code> compute functions (280) available</p></li>
<li><p>User-defined functions (UDFs): write your own R function and run in the <code>arrow</code> query engine</p></li>
</ul>
<div class="columns">
<div class="column" style="text-align: center;">
<a href="https://arrowrbook.com/data_manipulation.html" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrowrbook.com/data_manipulation.html","width":128});
  script.remove();
})();
</script>
    
<p>Book chapter</p>
</div><div class="column" style="text-align: center;">
<a href="https://arrow.apache.org/docs/r/reference/acero.html" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrow.apache.org/docs/r/reference/acero.html","width":128});
  script.remove();
})();
</script>
    
<p>List of supported functions</p>
</div></div>
</section>
<section id="should-i-use-arrow-or-duckdb" class="slide level2">
<h2>Should I use arrow or duckdb?</h2>
<div class="fragment">
<h3 id="yes"><strong>Yes!</strong></h3>
</div>
<div class="fragment">
<ul>
<li><p>For many workflows, either one will serve just fine</p></li>
<li><p>Historically, <code>arrow</code> has had richer dplyr integration</p></li>
<li><p>If you need advanced SQL features, use <code>duckdb</code></p></li>
<li><p>Mostly a matter of preference</p></li>
</ul>
</div>
</section>
<section id="section-12" class="slide level2" data-background-image="img/por-que-no-los-dos.gif">
<h2></h2>
</section>
<section id="section-13" class="slide level2" style="text-align: center;">
<h2></h2>

<img src="img/arrow-and-duckdb.png" class="r-stretch"></section>
<section id="arrow-and-duckdb" class="slide level2">
<h2>arrow <em>and</em> duckdb</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a>pums_person <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href=""></a>  <span class="fu">group_by</span>(location) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href=""></a>  <span class="fu">summarize</span>(</span>
<span id="cb11-4"><a href=""></a>    <span class="at">max_commute =</span> <span class="fu">max</span>(JWMNP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-5"><a href=""></a>    <span class="at">min_commute =</span> <span class="fu">min</span>(JWMNP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-6"><a href=""></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-7"><a href=""></a>  <span class="fu">to_duckdb</span>() <span class="sc">|&gt;</span> <span class="co"># send data to duckdb</span></span>
<span id="cb11-8"><a href=""></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>location, <span class="at">names_to =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-9"><a href=""></a>  <span class="fu">to_arrow</span>() <span class="sc">|&gt;</span> <span class="co"># return data back to arrow</span></span>
<span id="cb11-10"><a href=""></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="arrow-and-duckdb-1" class="slide level2">
<h2>arrow <em>and</em> duckdb</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="fu">open_dataset</span>(<span class="st">"gs://anonymous@scaling-arrow-pums/person/"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href=""></a>  <span class="fu">to_duckdb</span>(<span class="at">table_name =</span> <span class="st">"pums8"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href=""></a>  dbplyr<span class="sc">::</span><span class="fu">remote_con</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href=""></a>  DBI<span class="sc">::</span><span class="fu">dbGetQuery</span>(<span class="st">"</span></span>
<span id="cb12-5"><a href=""></a><span class="st">    SELECT</span></span>
<span id="cb12-6"><a href=""></a><span class="st">      year,</span></span>
<span id="cb12-7"><a href=""></a><span class="st">      SUM(AGEP * PWGTP) / SUM(PWGTP) AS mean_age</span></span>
<span id="cb12-8"><a href=""></a><span class="st">    FROM (SELECT * FROM pums8 WHERE location = 'wa')</span></span>
<span id="cb12-9"><a href=""></a><span class="st">    GROUP BY year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="key-takeaways" class="slide level2">
<h2>Key takeaways</h2>
<ul>
<li><p>Use Parquet files</p></li>
<li><p>Split large datasets into partitions based on common query patterns</p></li>
<li><p>Run modern query engines (<code>arrow</code>, <code>duckdb</code>) on your machine: just install from CRAN, no need for a big compute cluster or service</p></li>
<li><p>The <code>arrow</code> package provides a lot of this all in one. But if you need something lighterweight or more specialized, you have options (<code>nanoparquet</code>, <code>nanoarrow</code>, <code>duckdb</code>, etc.)</p></li>
<li><p>The Arrow format is the key to this modern data stack. It is what allows all of these tools to work together and share data efficiently</p></li>
</ul>
</section>
<section id="resources" class="slide level2">
<h2>Resources</h2>
<div class="columns">
<div class="column" style="text-align: center; width: 33%;">
<p>These slides</p>
<a href="https://enpiar.com/user-2025/" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://enpiar.com/user-2025/","width":128});
  script.remove();
})();
</script>
    
<!-- [enpiar.com/user-2025/](https://enpiar.com/user-2025/) -->
</div><div class="column" style="text-align: center; width: 33%;">
<p>Arrow R package</p>
<a href="https://arrow.apache.org/docs/r/" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrow.apache.org/docs/r/","width":128});
  script.remove();
})();
</script>
    
<!-- [arrow.apache.org/docs/r/](https://arrow.apache.org/docs/r/) -->
</div><div class="column" style="text-align: center; width: 33%;">
<p>Arrow project</p>
<a href="https://arrow.apache.org/" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrow.apache.org/","width":128});
  script.remove();
})();
</script>
    
<!-- [arrow.apache.org](https://arrow.apache.org/) -->
</div></div>
<div class="columns">
<div class="column" style="text-align: center; width: 33%;">
<p>Book website</p>
<a href="https://arrowrbook.com/" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://arrowrbook.com/","width":128});
  script.remove();
})();
</script>
    
</div><div class="column" style="text-align: center; width: 33%;">
<p>Buy a copy</p>
<a href="https://www.routledge.com/9781032660288" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://www.routledge.com/9781032660288","width":128});
  script.remove();
})();
</script>
    
<p>Save 20% with <code>25AFLY3</code></p>
</div><div class="column" style="text-align: center; width: 33%;">
<p>Me</p>
<a href="https://www.linkedin.com/in/enpiar/" class="qrcode"><div id="" class="qrcode"></div></a>
<script type="text/javascript">
(function() {
  var script = document.currentScript;
  var qrcode = script.previousElementSibling;
  qrcode.qrcode = new QRCode(qrcode, {"colorDark":"#000000","colorLight":"#ffffff","height":128,"text":"https://www.linkedin.com/in/enpiar/","width":128});
  script.remove();
})();
</script>
    
<!-- set bsky id so I am enpiar.com -->
</div></div>
</section>
<section id="working-with-cloud-storage" class="slide level2">
<h2>Working with cloud storage</h2>
<!-- Check time, these may go to after the end -->
<!-- cloud storage: `arrow` has built in support for reading and writing data from object storage like Amazon S3 and Google Cloud Storage. This means you can work with large datasets stored in the cloud without having to download everything to your local machine.

example s3 url, also s3_bucket() for working with auth -->
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a></span>
<span id="cb13-2"><a href=""></a>pums_s3 <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(<span class="st">"s3://scaling-arrow-pums/person/"</span>)</span>
<span id="cb13-3"><a href=""></a></span>
<span id="cb13-4"><a href=""></a><span class="co"># Query execution with lazy evaluation</span></span>
<span id="cb13-5"><a href=""></a>pums_s3 <span class="sc">|&gt;</span></span>
<span id="cb13-6"><a href=""></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2021</span>, location <span class="sc">==</span> <span class="st">"ca"</span>, AGEP <span class="sc">&gt;=</span> <span class="dv">16</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-7"><a href=""></a>  <span class="fu">group_by</span>(year, ST) <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href=""></a>  <span class="fu">summarize</span>(</span>
<span id="cb13-9"><a href=""></a>    <span class="at">mean_commute_time =</span> <span class="fu">sum</span>(JWMNP <span class="sc">*</span> PWGTP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb13-10"><a href=""></a>      <span class="fu">sum</span>(PWGTP),</span>
<span id="cb13-11"><a href=""></a>    <span class="at">count =</span> <span class="fu">n</span>()</span>
<span id="cb13-12"><a href=""></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-13"><a href=""></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="working-with-cloud-storage-1" class="slide level2">
<h2>Working with cloud storage</h2>
<!-- Can pass in more options for auth etc. this way, not everything is nicely encoded in the URL -->
<!-- Either way, it uses the AWS SDK and standard AWS auth mechanisms on your machine, so if you have a credential file or environment variables set up, it will just work. -->
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a>pums_bucket <span class="ot">&lt;-</span> <span class="fu">s3_bucket</span>(<span class="st">"scaling-arrow-pums"</span>)</span>
<span id="cb14-2"><a href=""></a>pums_s3 <span class="ot">&lt;-</span> <span class="fu">open_dataset</span>(pums_bucket<span class="sc">$</span><span class="fu">path</span>(<span class="st">"person"</span>))</span>
<span id="cb14-3"><a href=""></a></span>
<span id="cb14-4"><a href=""></a><span class="co"># Query execution with lazy evaluation</span></span>
<span id="cb14-5"><a href=""></a>pums_s3 <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href=""></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2021</span>, location <span class="sc">==</span> <span class="st">"ca"</span>, AGEP <span class="sc">&gt;=</span> <span class="dv">16</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href=""></a>  <span class="fu">group_by</span>(year, ST) <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href=""></a>  <span class="fu">summarize</span>(</span>
<span id="cb14-9"><a href=""></a>    <span class="at">mean_commute_time =</span> <span class="fu">sum</span>(JWMNP <span class="sc">*</span> PWGTP, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb14-10"><a href=""></a>      <span class="fu">sum</span>(PWGTP),</span>
<span id="cb14-11"><a href=""></a>    <span class="at">count =</span> <span class="fu">n</span>()</span>
<span id="cb14-12"><a href=""></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-13"><a href=""></a>  <span class="fu">collect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>